/* * File: EchoServer.java * Author: Java, Java, Java * Description: This class defines the server object of *  a simple client/server application. The application *  sets up a socket connection between the client and  *  server and simply echos strings input by the user. *  The server object reads a string sent by a client *  and sends the same string back over the socket. */import java.net.*;import java.io.*;public class EchoServer extends ClientServer {    private ServerSocket port;    private Socket socket1, socket2;    /**     * EchoServer() constructor creates a server object given     *  it port number and a number representing the number of     *  clients it can backlog.     * @param portNum -- an int giving the port number     * @param nBacklog -- the number of clients that can backlog     */        public EchoServer(int portNum, int nBacklog)  {        try {            port = new ServerSocket (portNum, nBacklog);        } catch (IOException e) {            e.printStackTrace();        }         }      /**     *  run() defines the server thread's main behavior which is     *   simply to provide service whenever it is requested by a client.      *   Since an I/O exception may result, it is handled here. The     *   server repeatedly accepts a connection from a client and     *   provides it whatever service is defined in provideService().     */    public void run() {        try {            System.out.println("Echo server at "                                + InetAddress.getLocalHost() + " waiting for connections ");            while(true) {                socket1 = port.accept();                socket2 = port.accept();                System.out.println("Accepted a connection from " + socket1.getInetAddress());                System.out.println("Accepted a connection from " + socket2.getInetAddress());                provideService(socket1, socket2);                socket1.close();                socket2.close();                System.out.println("Closed the connection\n");            }        } catch (IOException e) {             e.printStackTrace();        }    } // run()    /**     *  provideService() defines this server's service, which consists     *   of simply echoing whatever string it receives from the client.     *  The server's protocol calls for it to begin by saying hello     *  and end by saying goodbye. Isn't it polite?     */    protected void provideService (Socket socketX, Socket socketO) {        String str = "";        try {            writeToSocket(socketX, "XXNNNNNNNNNNNNNNNN00N--");            writeToSocket(socketO, "OXNNNNNNNNNNNNNNNN00N--");            //writeToSocket(socketX, "XX: Hello Socket X, how may I help you?\n");            //writeToSocket(socketO, "OX: Hello Socket O, how may I help you?\n");            do {                     str = readFromSocket(socketX);                str = checkWinner(str);                str = playAgain(str);                // check for winner and update str                if (str.toLowerCase().equals("goodbye"))                {                    writeToSocket(socketX, "Goodbye\n");                    writeToSocket(socketO, "Goodbye\n");                }                else                {                   // writeToSocket( socketX, "XO: Player X said '" + str + "'\n");                   // writeToSocket( socketO, "OO: Player X said '" + str + "'\n");                    writeToSocket( socketX, "XO" + str.substring(2));                                   writeToSocket( socketO, "OO" + str.substring(2));                                        System.out.println("X sent: " + str);                }                                   str = readFromSocket(socketO);                str = checkWinner(str);                str = playAgain(str);                // check for winner and update str                if (str.toLowerCase().equals("goodbye"))                {                    writeToSocket(socketX, "Goodbye\n");                    writeToSocket(socketO, "Goodbye\n");                }                else                {                    //writeToSocket( socketX, "XX: Player O said '" + str + "'\n");                    //writeToSocket( socketO, "OX: player O said '" + str + "'\n");                    writeToSocket( socketX, "XX" + str.substring(2));                    writeToSocket( socketO, "OX" + str.substring(2));                                 System.out.println("O sent: " + str);                }                                                           }  while (!str.toLowerCase().equals("goodbye"));        } catch (IOException e) {            e.printStackTrace();        }    } // provideServer()        public String checkWinner(String b) {                String boardInfo = new String (b);               String win5 = (new StringBuilder()).append(boardInfo.charAt(2)).append(boardInfo.charAt(6)).append(boardInfo.charAt(10)).append(boardInfo.charAt(14)).toString();        String win6 = (new StringBuilder()).append(boardInfo.charAt(3)).append(boardInfo.charAt(7)).append(boardInfo.charAt(11)).append(boardInfo.charAt(15)).toString();        String win7 = (new StringBuilder()).append(boardInfo.charAt(4)).append(boardInfo.charAt(8)).append(boardInfo.charAt(12)).append(boardInfo.charAt(16)).toString();        String win8 = (new StringBuilder()).append(boardInfo.charAt(5)).append(boardInfo.charAt(9)).append(boardInfo.charAt(13)).append(boardInfo.charAt(17)).toString();        String win9 = (new StringBuilder()).append(boardInfo.charAt(2)).append(boardInfo.charAt(7)).append(boardInfo.charAt(12)).append(boardInfo.charAt(17)).toString();                String win10 = (new StringBuilder()).append(boardInfo.charAt(5)).append(boardInfo.charAt(8)).append(boardInfo.charAt(11)).append(boardInfo.charAt(14)).toString();        if (boardInfo.charAt(20) == 'N') {            int xWin = 1;            int oWin = 1;            // Start of winning scenarios            // win 1            if ( "XXXX".equals(boardInfo.substring(2, 6)) || "OOOO".equals(boardInfo.substring(2,6)) ) {  // Win scenario 1                if ("XXXX".equals(boardInfo.substring(2, 6))) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }            // win 2            else if ( "XXXX".equals(boardInfo.substring(6, 10)) || "OOOO".equals(boardInfo.substring(6,10)) ) {                if ("XXXX".equals(boardInfo.substring(6, 10))) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }            // win 3            else if ( "XXXX".equals(boardInfo.substring(10, 14)) || "OOOO".equals(boardInfo.substring(10,14)) ) {                 if ("XXXX".equals(boardInfo.substring(10, 14))) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }            // win 4            else if ( "XXXX".equals(boardInfo.substring(14, 18)) || "OOOO".equals(boardInfo.substring(14,18)) ) {                if ("XXXX".equals(boardInfo.substring(14, 18))) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }                // win5            else if ( "XXXX".equals(win5) || "OOOO".equals(win5) ) {                if ("XXXX".equals(win5)) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }                // win6            else if ( "XXXX".equals(win6) || "OOOO".equals(win6) ) {                if ("XXXX".equals(win6)) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }                // win7            else if ( "XXXX".equals(win7) || "OOOO".equals(win7) ) {                if ("XXXX".equals(win7)) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }            // win 8            else if ( "XXXX".equals(win8) || "OOOO".equals(win8) ) {                if ("XXXX".equals(win8)) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }            // win 9            else if ( "XXXX".equals(win9) || "OOOO".equals(win9) ) {                if ("XXXX".equals(win9)) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }            // win 10            else if ( "XXXX".equals(win10) || "OOOO".equals(win10) ) {                if ("XXXX".equals(win10)) {                    boardInfo = boardInfo.substring(0,18) + Integer.toString(xWin) + boardInfo.substring(19,20) + "X" + boardInfo.substring(21);                    xWin++;                }                else {                    boardInfo = boardInfo.substring(0,19) + Integer.toString(oWin) + "O" + boardInfo.substring(21);                    oWin++;                }            }        }        // Tie Game//        else {//            boardInfo = boardInfo.substring(0,20) + "T" + boardInfo.substring(21);//        }         // End of winning scenarios         return boardInfo;    }        public String playAgain(String b) {        String str = new String(b);        System.out.println(str.substring(21));         if ( "YY".equals(str.substring(21)) ) {            str = str.substring(0,2) + "NNNNNNNNNNNNNNNN" + str.substring(18,20) + "N--";//            System.out.println(str.substring(21));         }         return str;    }      /**       *  main() creates an EchoServer at port 10002      */    public static void main(String args[]) {        EchoServer server = new EchoServer(10005,3);              server.start();    } // main()} // EchoServer 